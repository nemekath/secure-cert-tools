{% extends "layout.html" %}
{% block body %}
      <div class="text-center">
        <h4>Secure Cert-Tools</h4>
        <p>Professional certificate toolkit with CSR generation, validation, analysis, and verification capabilities.</p>
        
        <!-- Mode Selection Buttons -->
        <div class="btn-group btn-group-block">
          <button class="btn btn-primary btn-lg" id="generate-mode-btn" onclick="showGenerateMode()">Generate CSR</button>
          <button class="btn btn-secondary btn-lg" id="verify-mode-btn" onclick="showVerifyMode()">Verify CSR & Private Key</button>
          <button class="btn btn-secondary btn-lg" id="analyze-mode-btn" onclick="showAnalyzeMode()">Analyze CSR Content</button>
        </div>
      </div>
      
      <!-- Generate Mode -->
      <div id="generate-mode" class="mode-section">
        <div class="text-center" style="margin-top: 2rem;">
          <h5>Generate a Certificate Signing Request</h5>
          <p>Complete this form to generate a new CSR and private key.</p>
        </div>
      <div class="columns">
        <div class="centered column col-10">
          <div class="form-container">
          <form>
            <div class="form-group">
              <label class="form-label tooltip tooltip-left" data-tooltip="Two letter ISO country code (e.g., US, DE, FR)" for="C">Country</label>
              <input class="form-input input-lg" type="text" name="C" placeholder="US" maxlength="2" autofocus 
                     pattern="^[A-Z]{2}$" title="Two uppercase letters only (e.g., US, DE, FR)" 
                     oninput="validateCountryField(this)" style="text-transform: uppercase;" />
              <small class="form-input-hint text-error" id="country-error" style="display: none;">‚ùå Country code must be exactly 2 uppercase letters</small>
            </div>
            <div class="form-group">
              <label class="form-label tooltip tooltip-left" data-tooltip="Full state or province name" for="ST">State/Province</label>
              <input class="form-input input-lg" type="text" placeholder="Texas" name="ST" maxlength="128" 
                     pattern="^[a-zA-Z0-9\s\-\.,']+$" title="Letters, numbers, spaces, and common punctuation only" 
                     oninput="validateTextField(this, 'state-error')" />
              <small class="form-input-hint text-error" id="state-error" style="display: none;">‚ùå Invalid characters in state/province name</small>
            </div>
            <div class="form-group">
              <label class="form-label tooltip tooltip-left" data-tooltip="Full city or locality name" for="L">Locality/City</label>
              <input class="form-input input-lg" type="text" placeholder="San Antonio" name="L" maxlength="128" 
                     pattern="^[a-zA-Z0-9\s\-\.,']+$" title="Letters, numbers, spaces, and common punctuation only" 
                     oninput="validateTextField(this, 'locality-error')" />
              <small class="form-input-hint text-error" id="locality-error" style="display: none;">‚ùå Invalid characters in locality/city name</small>
            </div>
            <div class="form-group">
              <label class="form-label tooltip tooltip-left" data-tooltip="Full legal organization name" for="O">Organization</label>
              <input class="form-input input-lg" type="text" placeholder="Example Corp" name="O" maxlength="64" 
                     pattern="^[a-zA-Z0-9\s\-\.,'&()]+$" title="Letters, numbers, spaces, and common business punctuation only" 
                     oninput="validateTextField(this, 'org-error')" />
              <small class="form-input-hint text-error" id="org-error" style="display: none;">‚ùå Invalid characters in organization name</small>
            </div>
            <div class="form-group">
              <label class="form-label tooltip tooltip-left" data-tooltip="Department or division within organization" for="OU">Organizational Unit</label>
              <input class="form-input input-lg" type="text" placeholder="IT Department" name="OU" maxlength="64" 
                     pattern="^[a-zA-Z0-9\s\-\.,'&()]+$" title="Letters, numbers, spaces, and common punctuation only" 
                     oninput="validateTextField(this, 'ou-error')" />
              <small class="form-input-hint text-error" id="ou-error" style="display: none;">‚ùå Invalid characters in organizational unit name</small>
            </div>
            <div class="form-group">
              <label class="form-label tooltip tooltip-left" data-tooltip="The FQDN for your domain (no spaces allowed)" for="CN">Common Name</label>
              <input class="form-input input-lg" type="text" placeholder="example.com" name="CN" maxlength="64" required 
                     pattern="^[a-zA-Z0-9]([a-zA-Z0-9\-\.]*[a-zA-Z0-9])?$" 
                     title="Domain name without spaces (e.g., example.com, www.example.com)" 
                     oninput="validateCNField(this)" />
              <small class="form-input-hint text-error" id="cn-error" style="display: none;">‚ùå Common Name cannot contain spaces or invalid characters</small>
            </div>
            <div class="form-group">
              <label class="form-label tooltip tooltip-left" data-tooltip="Comma-separated list of alternative domain names (no spaces in domain names)" for="subjectAltNames">Subject Alternative Names</label>
              <input class="form-input input-lg" type="text" placeholder="api.example.com, *.example.com" name="subjectAltNames" 
                     pattern="^(\*\.[a-zA-Z0-9]([a-zA-Z0-9\-\.]*[a-zA-Z0-9])?|[a-zA-Z0-9]([a-zA-Z0-9\-\.]*[a-zA-Z0-9])?)?(\s*,\s*(\*\.[a-zA-Z0-9]([a-zA-Z0-9\-\.]*[a-zA-Z0-9])?|[a-zA-Z0-9]([a-zA-Z0-9\-\.]*[a-zA-Z0-9])?))*$" 
                     title="Comma-separated domain names including wildcards (e.g., *.example.com)" 
                     oninput="validateSANField(this)" />
              <small class="form-input-hint text-error" id="san-error" style="display: none;">‚ùå Invalid domain names in Subject Alternative Names</small>
            </div>
            <div class="form-group">
              <label class="form-label tooltip tooltip-left" data-tooltip="Type of cryptographic key to generate">Key Type</label>
              <label class="form-radio">
                <input type="radio" name="keyType" value="RSA" checked onchange="toggleKeyOptions()" />
                <i class="form-icon"></i> RSA
              </label>
              <label class="form-radio">
                <input type="radio" name="keyType" value="ECDSA" onchange="toggleKeyOptions()" />
                <i class="form-icon"></i> ECDSA (Elliptic Curve)
              </label>
            </div>
            <div class="form-group" id="rsa-options">
              <label class="form-label tooltip tooltip-left" data-tooltip="Size of the RSA modulus in bits">RSA Key Size</label>
              <label class="form-radio">
                <input type="radio" name="keySize" value="2048" checked />
                <i class="form-icon"></i> 2048
              </label>
              <label class="form-radio">
                <input type="radio" name="keySize" value="4096" />
                <i class="form-icon"></i> 4096
              </label>
            </div>
            <div class="form-group" id="ecdsa-options" style="display: none;">
              <label class="form-label tooltip tooltip-left" data-tooltip="ECDSA curve to use for key generation">ECDSA Curve</label>
              <label class="form-radio">
                <input type="radio" name="curve" value="P-256" checked />
                <i class="form-icon"></i> P-256 (secp256r1)
              </label>
              <label class="form-radio">
                <input type="radio" name="curve" value="P-384" />
                <i class="form-icon"></i> P-384 (secp384r1)
              </label>
              <label class="form-radio">
                <input type="radio" name="curve" value="P-521" />
                <i class="form-icon"></i> P-521 (secp521r1)
              </label>
            </div>
            <button class="btn btn-primary centered">üîê Generate CSR</button>
          </form>
          </div>
        </div>
      </div>
      </div>
      
      <!-- Verify Mode -->
      <div id="verify-mode" class="mode-section" style="display: none;">
        <div class="text-center" style="margin-top: 2rem;">
          <h5>Verify CSR & Private Key Match</h5>
          <p>Paste your CSR and private key to verify they belong together.</p>
        </div>
        <div class="columns">
          <div class="centered column col-10">
            <div class="form-container">
            <form id="verify-form">
              <div class="form-group">
                <label class="form-label" for="csr-input">Certificate Signing Request (CSR)</label>
                <textarea class="form-input" id="csr-input" name="csr" rows="15" placeholder="-----BEGIN CERTIFICATE REQUEST-----
Paste your CSR here...
-----END CERTIFICATE REQUEST-----" required></textarea>
              </div>
              <div class="form-group">
                <label class="form-label" for="private-key-input">Private Key</label>
                <textarea class="form-input" id="private-key-input" name="privateKey" rows="15" placeholder="-----BEGIN PRIVATE KEY-----
Paste your private key here...
-----END PRIVATE KEY-----" required></textarea>
              </div>
              <button type="submit" class="btn btn-primary centered">üîç Verify Match</button>
            </form>
            </div>
            
            <!-- Verification Result -->
            <div id="verification-result" class="mt-2" style="display: none;">
              <div class="result-modal-card">
                <div class="result-modal-header">
                  <h5 class="result-modal-title" id="result-title"></h5>
                </div>
                <div class="result-modal-body" id="result-message"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Analyze Mode -->
      <div id="analyze-mode" class="mode-section" style="display: none;">
        <div class="text-center" style="margin-top: 2rem;">
          <h5>Analyze CSR Content & RFC Compliance</h5>
          <p>Paste your CSR to see its content and check for RFC compliance violations.</p>
        </div>
        <div class="columns">
          <div class="centered column col-10">
            <div class="form-container">
            <form id="analyze-form">
              <div class="form-group">
                <label class="form-label" for="analyze-csr-input">Certificate Signing Request (CSR)</label>
                <textarea class="form-input" id="analyze-csr-input" name="csr" rows="20" placeholder="-----BEGIN CERTIFICATE REQUEST-----
Paste your CSR here for analysis...
-----END CERTIFICATE REQUEST-----" required></textarea>
              </div>
              <button type="submit" class="btn btn-primary centered">üîç Analyze CSR</button>
            </form>
            </div>
            
            <!-- Analysis Result -->
            <div id="analysis-result" class="mt-2" style="display: none;">
              <div class="result-modal-card">
                <div class="result-modal-header">
                  <h5 class="result-modal-title" id="analysis-title">üìã CSR Analysis Results</h5>
                </div>
                <div class="result-modal-body" id="analysis-content">
                  <!-- Analysis content will be dynamically inserted here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- CSR Generation Result Modal -->
      <div id="csr-modal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-container modal-xl">
          <div class="modal-header">
            <h4 class="modal-title">üîê Generated CSR & Private Key</h4>
            <button type="button" class="btn btn-clear close float-right"></button>
          </div>
          <div class="modal-body">
            <div class="content">
              <!-- Warning Message -->
              <div class="toast toast-warning mb-2">
                <div class="toast-body">
                  <strong>‚ö†Ô∏è Important:</strong> Save both the CSR and private key securely. The private key cannot be recovered if lost.
                </div>
              </div>
              
              <!-- Vertical Layout -->
              <div class="vertical-layout">
                <!-- CSR Section -->
                <div class="output-section">
                  <div class="csr-section">
                    <div class="section-header">
                      <h5 class="section-title">üìÑ Certificate Signing Request (CSR)</h5>
                      <button class="btn btn-primary btn-sm copy-btn" onclick="copyToClipboard('#csr', this)">
                        <i class="icon icon-copy"></i> Copy CSR
                      </button>
                    </div>
                    <div class="textarea-container">
                      <textarea id="csr" class="form-input code-textarea" readonly="readonly" 
                                onclick="this.select()" title="Click to select all content"></textarea>
                      <div class="textarea-overlay" onclick="document.getElementById('csr').select()">
                        <span class="overlay-text">Select All</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Private Key Section -->
                <div class="output-section">
                  <div class="private-key-section">
                    <div class="section-header">
                      <h5 class="section-title">üîë Private Key</h5>
                      <button class="btn btn-error btn-sm copy-btn" onclick="copyToClipboard('#private-key', this)">
                        <i class="icon icon-copy"></i> Copy Key
                      </button>
                    </div>
                    <div class="textarea-container">
                      <textarea id="private-key" class="form-input code-textarea" readonly="readonly" 
                                onclick="this.select()" title="Click to select all content"></textarea>
                      <div class="textarea-overlay" onclick="document.getElementById('private-key').select()">
                        <span class="overlay-text">Select All</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <div class="footer-content">
              <div class="footer-actions">
                <button class="btn btn-success" onclick="downloadCSR()">üíæ Download CSR</button>
                <button class="btn btn-success" onclick="downloadPrivateKey()">üíæ Download Key</button>
                <button class="btn btn-secondary close">‚úï Close</button>
              </div>
            </div>
          </div>
        </div>
      </div>
{% endblock %}
